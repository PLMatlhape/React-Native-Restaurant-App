# ğŸ—„ï¸ Firebase Database Schema - React Native Restaurant App

## ğŸ“‹ Table of Contents
1. [Firebase Services Required](#firebase-services-required)
2. [Cloud Firestore Collections](#cloud-firestore-collections)
3. [Firebase Authentication](#firebase-authentication)
4. [Firebase Storage Structure](#firebase-storage-structure)
5. [Security Rules](#security-rules)
6. [Data Relationships](#data-relationships)

---

## ğŸ”¥ Firebase Services Required

### âœ… Services You MUST Enable in Firebase Console

| Service | Status | Purpose | How to Enable |
|---------|--------|---------|---------------|
| **Authentication** | âœ… Enabled | User login/registration | Firebase Console â†’ Authentication â†’ Sign-in method â†’ Email/Password â†’ Enable |
| **Cloud Firestore** | âš ï¸ **MUST ENABLE** | Database for users, orders, food items | Firebase Console â†’ Firestore Database â†’ Create database â†’ Start in test mode |
| **Storage** | âš ï¸ **MUST ENABLE** | Food item images | Firebase Console â†’ Storage â†’ Get started â†’ Start in test mode |

### ğŸš¨ IMPORTANT: These errors are likely caused by Firestore NOT being enabled!

The "Component auth has not been registered yet" error can sometimes be a cascade effect when Firebase services fail to initialize properly. Enable **Cloud Firestore** and **Storage** first, then test again.

---

## ğŸ“¦ Cloud Firestore Collections

### Collection: `users`

Stores user profile information linked to Firebase Authentication.

```typescript
// Document ID: user.uid (from Firebase Auth)
{
  uid: string,              // Firebase Auth UID (same as document ID)
  name: string,             // User's first name
  surname: string,          // User's last name
  email: string,            // User's email address
  contactNumber: string,    // Phone number
  address: string,          // Delivery address
  cardDetails: {            // Payment card info (encrypted in production)
    cardNumber: string,     // Card number
    cardHolder: string,     // Name on card
    expiryDate: string,     // MM/YY format
    cvv: string             // CVV code
  },
  role: "customer" | "admin",  // User role
  createdAt: string,        // ISO 8601 timestamp
  updatedAt: string         // ISO 8601 timestamp
}
```

**Example Document:**
```json
{
  "uid": "abc123xyz789",
  "name": "John",
  "surname": "Doe",
  "email": "john.doe@example.com",
  "contactNumber": "+27 82 123 4567",
  "address": "123 Main Street, Johannesburg, 2000",
  "cardDetails": {
    "cardNumber": "4111111111111111",
    "cardHolder": "JOHN DOE",
    "expiryDate": "12/25",
    "cvv": "123"
  },
  "role": "customer",
  "createdAt": "2025-01-15T10:30:00.000Z",
  "updatedAt": "2025-01-15T10:30:00.000Z"
}
```

---

### Collection: `foodItems`

Stores menu items for the coffee shop.

```typescript
// Document ID: auto-generated by Firestore
{
  name: string,             // Food item name
  description: string,      // Item description
  price: number,            // Price in ZAR (South African Rand)
  category: string,         // Category name
  imageUrl: string,         // URL to image (from Storage or external)
  isAvailable: boolean,     // Whether item is currently available
  rating: number,           // Average rating (0-5)
  reviews: number,          // Number of reviews
  ingredients: string[],    // List of ingredients (optional)
  allergens: string[],      // Allergen information (optional)
  preparationTime: number,  // Time in minutes (optional)
  calories: number,         // Calorie count (optional)
  createdAt: string,        // ISO 8601 timestamp
  updatedAt: string         // ISO 8601 timestamp
}
```

**Example Document:**
```json
{
  "name": "Cappuccino Classic",
  "description": "Traditional cappuccino with equal parts espresso, steamed milk, and foam",
  "price": 35,
  "category": "Cappuccino",
  "imageUrl": "https://firebasestorage.googleapis.com/...",
  "isAvailable": true,
  "rating": 4.5,
  "reviews": 128,
  "ingredients": ["Espresso", "Steamed Milk", "Foam"],
  "allergens": ["Dairy"],
  "preparationTime": 5,
  "calories": 120,
  "createdAt": "2025-01-01T00:00:00.000Z",
  "updatedAt": "2025-01-15T12:00:00.000Z"
}
```

**Categories in the app:**
- Coffee
- Tea
- Cappuccino
- Waffles
- Cakes
- Milkshakes
- Smoothies
- Snacks
- Sandwiches

---

### Collection: `orders`

Stores customer orders.

```typescript
// Document ID: auto-generated by Firestore
{
  userId: string,           // Reference to users collection (uid)
  items: [                  // Array of ordered items
    {
      foodId: string,       // Reference to foodItems collection
      name: string,         // Item name (denormalized for quick access)
      price: number,        // Price at time of order
      quantity: number,     // Quantity ordered
      specialInstructions: string  // Optional special requests
    }
  ],
  totalAmount: number,      // Total order amount
  status: "pending" | "confirmed" | "preparing" | "ready" | "delivered" | "cancelled",
  paymentMethod: string,    // "card", "cash", etc.
  paymentStatus: "pending" | "paid" | "failed" | "refunded",
  deliveryAddress: string,  // Delivery address (optional)
  notes: string,            // Order notes (optional)
  createdAt: string,        // ISO 8601 timestamp
  updatedAt: string,        // ISO 8601 timestamp
  estimatedDelivery: string // Estimated delivery time (optional)
}
```

**Example Document:**
```json
{
  "userId": "abc123xyz789",
  "items": [
    {
      "foodId": "food123",
      "name": "Cappuccino Classic",
      "price": 35,
      "quantity": 2,
      "specialInstructions": "Extra hot"
    },
    {
      "foodId": "food456",
      "name": "Chocolate Waffle",
      "price": 50,
      "quantity": 1,
      "specialInstructions": ""
    }
  ],
  "totalAmount": 120,
  "status": "preparing",
  "paymentMethod": "card",
  "paymentStatus": "paid",
  "deliveryAddress": "123 Main Street, Johannesburg",
  "notes": "Please ring doorbell twice",
  "createdAt": "2025-01-15T14:30:00.000Z",
  "updatedAt": "2025-01-15T14:45:00.000Z",
  "estimatedDelivery": "2025-01-15T15:15:00.000Z"
}
```

---

## ğŸ” Firebase Authentication

### Authentication Provider: Email/Password

**User Properties managed by Firebase Auth:**
- `uid` - Unique user identifier
- `email` - User's email address
- `displayName` - Full name (set during registration)
- `emailVerified` - Email verification status
- `createdAt` - Account creation timestamp

**Note:** Additional user data (name, address, payment info) is stored in the `users` Firestore collection.

---

## ğŸ“ Firebase Storage Structure

```
/
â”œâ”€â”€ foodItems/
â”‚   â”œâ”€â”€ {itemId}/
â”‚   â”‚   â””â”€â”€ image.jpg          # Main food item image
â”‚   â”‚   â””â”€â”€ thumbnail.jpg      # Thumbnail version
â”‚
â”œâ”€â”€ categories/
â”‚   â”œâ”€â”€ Coffee.jpg
â”‚   â”œâ”€â”€ Tea.jpg
â”‚   â”œâ”€â”€ Waffles.jpg
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ users/
    â””â”€â”€ {userId}/
        â””â”€â”€ profile.jpg        # User profile picture (optional)
```

---

## ğŸ”’ Security Rules

### Firestore Security Rules

Create these rules in Firebase Console â†’ Firestore Database â†’ Rules:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Users collection
    match /users/{userId} {
      // Users can only read/write their own document
      allow read, write: if request.auth != null && request.auth.uid == userId;
      // Admins can read all users
      allow read: if request.auth != null && 
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
    
    // Food items collection
    match /foodItems/{itemId} {
      // Anyone authenticated can read food items
      allow read: if request.auth != null;
      // Only admins can create/update/delete
      allow write: if request.auth != null && 
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
    
    // Orders collection
    match /orders/{orderId} {
      // Users can read their own orders
      allow read: if request.auth != null && 
        resource.data.userId == request.auth.uid;
      // Users can create orders for themselves
      allow create: if request.auth != null && 
        request.resource.data.userId == request.auth.uid;
      // Only admins can update order status
      allow update: if request.auth != null && 
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
      // Admins can read all orders
      allow read: if request.auth != null && 
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
  }
}
```

### Storage Security Rules

Create these rules in Firebase Console â†’ Storage â†’ Rules:

```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    
    // Food item images - readable by all authenticated users
    match /foodItems/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null; // Restrict to admin in production
    }
    
    // Category images - readable by all
    match /categories/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null; // Restrict to admin in production
    }
    
    // User profile images
    match /users/{userId}/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
```

---

## ğŸ”— Data Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Firebase Auth   â”‚       â”‚      users       â”‚
â”‚                  â”‚       â”‚    Collection    â”‚
â”‚  â€¢ uid           â”‚â—„â”€â”€â”€â”€â”€â”€â”‚  â€¢ uid (doc id)  â”‚
â”‚  â€¢ email         â”‚       â”‚  â€¢ name          â”‚
â”‚  â€¢ displayName   â”‚       â”‚  â€¢ email         â”‚
â”‚                  â”‚       â”‚  â€¢ role          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ userId
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    foodItems     â”‚       â”‚      orders      â”‚
â”‚    Collection    â”‚       â”‚    Collection    â”‚
â”‚                  â”‚       â”‚                  â”‚
â”‚  â€¢ id (doc id)   â”‚â—„â”€â”€â”€â”€â”€â”€â”‚  â€¢ userId        â”‚
â”‚  â€¢ name          â”‚ foodIdâ”‚  â€¢ items[].foodIdâ”‚
â”‚  â€¢ price         â”‚       â”‚  â€¢ totalAmount   â”‚
â”‚  â€¢ category      â”‚       â”‚  â€¢ status        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Quick Setup Steps

### 1. Enable Cloud Firestore
1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Select your project: `react-native-restaurant-eba21`
3. Click **Firestore Database** in left sidebar
4. Click **Create database**
5. Select **Start in test mode** (for development)
6. Choose location (e.g., `nam5 (us-central)`)
7. Click **Enable**

### 2. Enable Firebase Storage
1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Select your project: `react-native-restaurant-eba21`
3. Click **Storage** in left sidebar
4. Click **Get started**
5. Select **Start in test mode** (for development)
6. Click **Next** â†’ **Done**

### 3. Seed Initial Data
After enabling Firestore, you can manually add documents or use the SAMPLE_DATA.json file to seed the `foodItems` collection.

---

## âš ï¸ Development vs Production Notes

**Test Mode Rules (Current - for development):**
```javascript
// These expire after 30 days!
allow read, write: if request.time < timestamp.date(2025, 2, 15);
```

**For Production:**
- Replace test mode rules with the security rules provided above
- Enable email verification
- Encrypt sensitive data (card details)
- Set up Firebase App Check for additional security

---

## ğŸ“Š Indexes Required

Create these composite indexes in Firebase Console â†’ Firestore â†’ Indexes:

| Collection | Fields | Query Scope |
|------------|--------|-------------|
| `orders` | `userId` ASC, `createdAt` DESC | Collection |
| `foodItems` | `category` ASC, `name` ASC | Collection |
| `foodItems` | `isAvailable` ASC, `category` ASC | Collection |

---

*Generated for React Native Restaurant App - January 2025*
